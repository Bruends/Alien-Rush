"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),randomInt=function(e,t){return Math.floor(Math.random()*t+e)},playBackgoudMusic=function(){var e=new Audio("sounds/bgMusic.wav");e.loop=!0,e.volume=.3,e.play()},playGameOverMusic=function(){var e=new Audio("sounds/gameOver.ogg");e.loop=!1,e.volume=.4,e.play()},Character=function(){function e(t,s){_classCallCheck(this,e),this.x=20,this.y=250,this.width=52,this.height=43,this.gravity=t,this.fly_force=s,this.mousePressed=!1,this.img=new Image,this.img.src="images/character.png"}return _createClass(e,[{key:"fly",value:function(){this.y-=this.fly_force}},{key:"fall",value:function(){this.y+=this.gravity}},{key:"action",value:function(){this.mousePressed?this.fly():this.fall()}},{key:"draw",value:function(e){e.drawImage(this.img,this.x,this.y)}}]),e}(),Engine=function(){function e(t,s,i){_classCallCheck(this,e),this.context=t,this.character=s,this.obstacles=i,this.score=0,this.hiScore=0,this.fixedBg=new Image,this.fixedBg.src="images/black.png",this.movingBg=new Image,this.movingBg.src="images/cavernBg.png",this.movingBgPos=0,this.menu=document.getElementById("game-menu"),this.scoreSpan=document.getElementById("score"),this.menuMsg=document.getElementById("msg"),this.hiScoreSpan=document.getElementById("hi-score"),this.playing=!1}return _createClass(e,[{key:"startGame",value:function(){this.menu.style.display="none",this.obstacles.obstaclesInScreen=[],this.character.y=250,this.score=0,this.playing=!0}},{key:"gameOver",value:function(){this.playing=!1,this.menu.style.display="block",this.menuMsg.textContent="Game Over",this.score>this.hiScore&&(this.hiScore=this.score),this.hiScoreSpan.textContent="Record:  "+this.hiScore,playGameOverMusic()}},{key:"setControlls",value:function(){var e=this.character;window.addEventListener("mousedown",function(){e.mousePressed=!0}),window.addEventListener("mouseup",function(){e.mousePressed=!1});var t=this.startGame;document.getElementById("btn-start").addEventListener("click",t.bind(this))}},{key:"checkCollision",value:function(){(this.character.y<=-40||this.character.y>=600)&&this.gameOver();var e=this.character,t=this.obstacles.obstaclesInScreen,s=!0,i=!1,n=void 0;try{for(var a,r=t[Symbol.iterator]();!(s=(a=r.next()).done);s=!0){var o=a.value;e.x>=o.x&&(e.y>=o.y&&e.y<=o.y+o.height||e.y+e.height>=o.y&&e.y+e.height<=o.y+o.height)&&this.gameOver()}}catch(e){i=!0,n=e}finally{try{!s&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"draw",value:function(){this.context.drawImage(this.fixedBg,0,0),this.context.drawImage(this.movingBg,this.movingBgPos,0),this.movingBgPos>=-600?this.movingBgPos-=4:this.movingBgPos=0,this.playing&&(this.character.draw(this.context),this.obstacles.draw(this.context))}},{key:"run",value:function(){this.draw(),this.playing&&(this.character.action(),this.obstacles.updateObstaclesInScreen(),this.checkCollision(),this.scoreSpan.textContent=this.score,this.score++)}}]),e}();window.onload=function(){var e=document.getElementById("game");this.context=e.getContext("2d"),e.height=600,e.width=600;var t=new Character(6,6.5),s=new Obstacles,i=new Engine(this.context,t,s);i.setControlls();playBackgoudMusic(),function e(){window.requestAnimationFrame(e),i.run()}()};var Obstacles=function(){function e(){_classCallCheck(this,e),this.obstaclesInScreen=[],this.spawnTime=1,this.image=new Image,this.image.src="images/obstacle.png"}return _createClass(e,[{key:"spawnObstacle",value:function(e){this.obstaclesInScreen.push({x:600,y:randomInt(10,600),width:43,height:43,movingSpeed:randomInt(8,11)})}},{key:"updateObstaclesInScreen",value:function(){this.spawnTime<=0?(this.spawnObstacle(),this.spawnTime=10):this.spawnTime--;for(var e in this.obstaclesInScreen){var t=this.obstaclesInScreen[e];t.x<=-10?this.obstaclesInScreen.splice(e,1):t.x-=t.movingSpeed}}},{key:"draw",value:function(e){var t=this.image,s=!0,i=!1,n=void 0;try{for(var a,r=this.obstaclesInScreen[Symbol.iterator]();!(s=(a=r.next()).done);s=!0){var o=a.value;e.drawImage(t,o.x,o.y)}}catch(e){i=!0,n=e}finally{try{!s&&r.return&&r.return()}finally{if(i)throw n}}}}]),e}();